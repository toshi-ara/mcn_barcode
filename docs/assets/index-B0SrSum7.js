(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();"BarcodeDetector"in window||alert("このブラウザは Barcode Detector をサポートしていません");const v=new window.BarcodeDetector({formats:["codabar"]});v||alert("このブラウザは Barcode Detector をサポートしていません");const D=/^[A-D](\d{6})[A-D]$/;let d=null,y=!1,s=[],p="";const g="ReadBarcode",h=document.getElementById("initial"),I=document.getElementById("scan"),L=document.getElementById("header"),w=document.getElementById("scan-btn"),E=document.getElementById("clear-btn"),u=document.getElementById("start-btn"),c=document.getElementById("back-btn"),l=document.getElementById("video"),C=document.getElementById("item-number"),m=document.getElementById("result-list");w.addEventListener("click",O);E.addEventListener("click",T);u.addEventListener("click",N);c.addEventListener("click",$);function b(t){t==="initial"?(h.style.display="block",L.style.display="block",w.style.display="block",E.style.display="block",I.style.display="none",f(),k()):t==="scan"&&(I.style.display="block",u.style.display="inline",c.style.display="inline",l.style.display="none",h.style.display="none",m.innerHTML="")}function O(){b("scan")}function $(){b("initial")}async function N(){y?(y=!1,u.textContent="スキャン開始",c.disabled=!1,c.style.backgroundColor="#007bff",l.style.display="none",A()):(y=!0,u.textContent="スキャン停止",c.disabled=!0,c.style.backgroundColor="gray",l.style.display="block",x())}function T(){confirm("保持データを消去しますか？")&&(s=[],p="",f(),m.innerHTML="",localStorage.removeItem(g))}async function x(){d=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}),l.srcObject=d,S()}function A(){d&&(d.getTracks().forEach(t=>t.stop()),l.srcObject=null,d=null)}async function S(){try{const t=await v.detect(l);t.length>0&&M(t[0].rawValue)}catch(t){console.error(t)}setTimeout(S,500)}function M(t){if(t===p)return;const i=t.match(D);i?(P(i[1]),p=t,R(s)):alert("無効なバーコードです")}function P(t){const i=new Date,n=new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(i),e=Object.fromEntries(n.map(B=>[B.type,B.value])),o=`${e.year}-${e.month}-${e.day}T${e.hour}:${e.minute}:${e.second}`,a=document.createElement("div");a.className="result-item",a.textContent=`ID: ${t} (timestamp ${o})`,m.insertBefore(a,m.firstChild),s.push({id:t,timestamp:o}),f(),j(100),navigator.vibrate(100)}function f(){const t=new Set(s.map(r=>r.id)),i=s.length;C.textContent=`登録 ${t.size}件（合計 ${i}件）`}function k(){const i=[...s].sort((n,e)=>{const o=Number(n.id)-Number(e.id);return o!==0?o:n.timestamp<e.timestamp?-1:n.timestamp>e.timestamp?1:0}).filter((n,e,o)=>e===o.findIndex(a=>a.id===n.id));let r="";for(const n of i)r=r+`${n.id}: ${n.timestamp}<BR>`;m.innerHTML=r}function j(t){const i=window.AudioContext||window.webkitAudioContext,r=new i,n=r.createOscillator(),e=r.createGain();n.connect(e),e.connect(r.destination),n.type="sine",n.frequency.value=1e3,e.gain.value=.1,n.start(),n.stop(r.currentTime+t/1e3)}function R(t){localStorage.setItem(g,JSON.stringify(t))}function H(){const t=localStorage.getItem(g);return t?JSON.parse(t):[]}document.addEventListener("DOMContentLoaded",()=>{b("initial"),s=H(),f(),k()});
